{% load staticfiles %}
<!doctype html>
<html>
  <head>
    <title>Nexus9k Automation Tool</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <script src="{% static 'node_modules/babel-core/browser-polyfill.min.js' %}"></script>
    <script src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
  </head>
  <body>
    <header id="header">
      <div class="container">
        <img src="http://1-cloud.net/wp-content/uploads/2014/12/ext-e1423455969481.jpg">
      </div>
    </header>
    <div id="content" class="container">
      <div class="main-content">
        <div id="get-started" class="">
          <div class="overflow-hidden">
            <!--<svg class="typology">
              <rect width="50" height="50" x="85" y="40" style="fill:#f2f2f2;stroke-width:1;stroke:#aaa" />
              <rect width="50" height="50" x="305" y="40" style="fill:#f2f2f2;stroke-width:1;stroke:#aaa" />
              <rect width="50" height="30" x="35" y="130" style="fill:#f2f2f2;stroke-width:1;stroke:#aaa" />
              <rect width="50" height="30" x="125" y="130" style="fill:#f2f2f2;stroke-width:1;stroke:#aaa" />
              <rect width="50" height="30" x="255" y="130" style="fill:#f2f2f2;stroke-width:1;stroke:#aaa" />
              <rect width="50" height="30" x="355" y="130" style="fill:#f2f2f2;stroke-width:1;stroke:#aaa" />
            </svg>
            -->
            <img src="{% static 'img/switch_topo.gif' %}" class="topology">
            <div class="hidden">
              <h2 class="gop">Automating Nexus 9000 Deployment</h2>
              <p>
                Now there's an easier way to provision your Data Center!

                With the Nexus 9000 automation tool, you can generate CLI configurations for repetitive tasks that are based on Cisco best practices.
              </p>
              <p>
                Simply select a configuration type, input your configuration variables (or use the ones provided), then copy/paste the generated CLI's to your Nexus 9000 switches.
              </p>
              <div class="conversion-options"><strong><small>Conversion options:</small> <div class="row" style="display: inline-block; margin-left: 5px;">
                    <span class="cisco"><a target="_blank" href="http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/6-x/programmability/guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Configuration_Guide_chapter_0101.pdf"><img src="{% static 'img/cisco.gif' %}"><span>NX-API</span></a></span>
                    <span><a target="_blank" href="http://www.ansible.com/home"><img src="{% static 'img/ansible-logo.png' %}"></a></span>
                    <span><a target="_blank" href="https://puppetlabs.com/"><img src="{% static 'img/puppet-labs-logo.png' %}"></a></span>
                  </div></strong>
                  <p>
                    Optionally, convert the generated CLI configurations into syntax that can be consumed by Cisco NX-API,  Puppet, or Ansible for further customization.
                  </p>
              </div>
            </div>
            <!--
            <iframe class="push-right" width="400" height="225" src="https://www.youtube.com/embed/e3McMaHvlBY" frameborder="0" allowfullscreen></iframe>
            -->
          </div>
        </div>
        <h2 class="headline">Step 1: Select Configuration Type to Automate</h2>
        <div class="add-padding">
          <select id="automation-select">
            <option>EVPN: VXLAN with MP-BGP Overlay</option>
          </select>
        </div>
        <h2 class="headline singled">Step 2: Define Configuration Variables</h2>
        <div class="add-padding">
          <div class="overflow-auto">
            <table spellcheck="false">
              <thead>
                {% for row in nexus_config|slice:"1:2" %}
                  <tr>
                  {% for cell in row %}
                    <th>{{ cell }}</th>
                  {% endfor %}
                  </tr>
                {% endfor %}
              </thead>
              <tbody>
                {% for row in nexus_config|slice:"2:" %}
                  <tr>
                  {% for cell in row %}
                    <td contenteditable="true">{{ cell }}</td>
                  {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <button class="save-config">Save Configuration (CSV)</button>
        <h2 class="headline">Step 3: Generate CLI Configuration</h2>
        <div class="add-padding">
          <div class="left">
            <p>Generate CLI configuration from the table above.</p>
            <div class="or"><span>or</span></div>
            <div class="file-wrapper"><button>Upload Custom CSV Configuration</button><input type="file" id="generate-cli" name="config_csv"></div>
            <button class="generate" id="generate_config_cli">Generate CLI Configuration</button>
          </div>
          <p class="clear desc">
            Once you have completed this step, you can either take the generated configuration
            files and copy/paste them onto your respective spine/leaf switches
            or convert them to NX-API/Ansible/Puppet in the step below.
          </p>
        </div>
        <h2 class="headline no-space">Step 4: Convert CLI Configuration to NX-API/Puppet/Ansible (Programmable Option)</h2>
        <div class="hidden">
          <div class="left">
            <p>Convert using the CLI configuration generated above.</p>
            <div class="or"><span>or</span></div>
            <div class="file-wrapper"><button>Upload Custom CLI Configuration</button><input type="file"></div>
            <br><br>
          </div>
          <i class="fa fa-chevron-circle-right" style="float: left;"></i>
          <div style="float: left; width: 500px;">
            <div style="white-space: nowrap; margin-bottom: 10px">
              <span>Select the format to convert the configuration to: </span>
              <select id="automation-format" class="move-abit">
                <option>NX-API</option>
                <option>Puppet</option>
                <option>Ansible</option>
              </select>
            </div>
            <div id="NX-API" style="display: block" class="c">
              <p class="mn">
                Fill the information and convert the CLI Command's text file to NXAPI Switch OFF-Box python script.
              </p>
              <div>
                <input type="text" placeholder="Switch IP Address">
              </div>
              <div>
                <input type="text" placeholder="Switch Username">
              </div>
              <div>
                <input type="text" placeholder="Switch Password">
              </div>
              <div class="output">
                <input type="text" placeholder="Output Filename">
              </div>
            </div>
            <div id="Puppet" class="c">
              <p class="mn">
                Fill the information and convert the CLI Command's text file to Puppet manifest.
              </p>
              <div>
                <input type="text" placeholder="Classname">
              </div>
              <div class="output">
                <input type="text" placeholder="Output Filename">
              </div>
            </div>
            <div id="Ansible" class="c">
              <p class="mn">
                Fill the information and convert the CLI Command's text file to Ansible Playbook.
              </p>
              <div>
                <input type="text" placeholder="Description">
              </div>
              <div>
                <input type="text" placeholder="Host">
              </div>
              <div class="output">
                <input type="text" placeholder="Output Filename">
              </div>
            </div>
            <button class="download-l">Convert and Download</button>
          </div>
        </div>
      </div>
    </div>
    <script src="{% static 'js/main-compiled.js' %}"></script>
    <script>
      (function () {
        var current = '';

        document.querySelector('.save-config').addEventListener('click', function () {
          window.location.href = "/static/nexus_config.csv";
        });

jQuery("#generate_config_cli").click( function (){
	var error_msg = " ";
	var error_flag = false;
	var code_file = jQuery("#generate-cli").val();	
	if( code_file == 0) {
    error_msg += " * Need to upload Config CSV file.\n";
    error_flag = true;
    }
	var ext = jQuery('#generate-cli').val().split('.').pop().toLowerCase();
	if(jQuery.inArray(ext, ['csv']) == -1) {
		error_msg += " *  Invalid extension for file. Only 'csv' files are supported..\n";
        error_flag = true;
	} 
	if( error_flag == true) {
		alert(error_msg);
	}
	else{
		var fileInput = document.getElementById('generate-cli');
		var file = fileInput.files[0];
		if (file.type.match("csv")) {
		  var reader = new FileReader();
		  reader.onload = function(e) {
			  var csv = reader.result.replace(/\r?\n/g, '^');
			var converturl = "http://104.236.21.104:9090/nexus_config_cli/convert/?config_csv="+csv;
			document.location.href = converturl;
		  }
		  reader.readAsText(file);  
		} 				
	}	
});

        document.querySelector('.download-l').addEventListener('click', function () {

        });

        var previous = '';

        $('#automation-format').on('focus', function () {
          previous = this.value;
        }).change(function(e) {
          $('#' + previous).hide();
          $('#' + e.target.value).toggle();
          previous = this.value;
        });
      }());
    </script>
  </body>
</html>
